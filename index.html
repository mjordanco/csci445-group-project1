<!DOCTYPE HTML>
<html>
<head>
<title> That Bull Eyes! </title>
<link rel="stylesheet" type="text/css" href="bullEyes.css" />
<script type="text/javascript">
var canvas = document.getElementById("mCanvas");
var frame = 0;
var mouseX = 0;
var mouseY = 0;

var brightness = 0;

var flashTime = 0;

var points = 0;

var enemy = new Enemy();
var radiusChange = 0;
var minRadius = 20;
var maxRadius = 100;
var xChange = 0;
var yChange = 0;

window.setInterval(drawScreen, 32);
window.setInterval(gameLogic, 32);

function handleMouseMove(event) {
	canvas = document.getElementById("mCanvas");

	var top = window.pageYOffset || document.documentElement.scrollTop
	var left = window.pageXOffset || document.documentElement.scrollLeft

	mouseX=event.clientX-10-canvas.offsetLeft+left;
	mouseY=event.clientY-10-canvas.offsetTop+top;
}

function handleMouseClick() {
	flashTime=10;
	var gunsound = document.getElementById("gunshot");
	gunsound.currentTime=0;
	gunsound.play();

	var xDif = enemy.xPosition - mouseX;
	var yDif = enemy.yPosition - mouseY;

	var dist = Math.sqrt(xDif * xDif + yDif * yDif);

	document.getElementById("mTextArea").value = dist;
	if (dist < enemy.radius) {
		points++;
		enemy = new Enemy();
		minRadius = enemy.radius * .75;
		maxRadius = enemy.radius * 1.25;
		var rand = Math.random();
		if (rand > .8) {
			rand = Math.random();
			if (rand > .5) {
				radiusChange = 1;
			} else {
				radiusChange = -1;
			}
			
			xChange = Math.round(Math.random() * 10) - 5;
			yChange = Math.round(Math.random() * 10) - 5;
		} else {
			radiusChange = 0;
			xChange = 0;
			yChange = 0;
		}
	} 
}

function gameLogic() {
	frame++;

	if (enemy.radius + radiusChange > minRadius && enemy.radius + radiusChange < maxRadius) {
		enemy.radius += radiusChange;
	} else {
		radiusChange = -radiusChange;
	}

	if (enemy.xPosition + xChange < 1000 && enemy.xPosition + xChange > 0) {
		enemy.xPosition += xChange;
	} else {
		xChange = -xChange;
	}

	if (enemy.yPosition + yChange < 500 && enemy.yPosition + yChange > 0) {
		enemy.yPosition += yChange;
	} else {
		yChange = -yChange;
	}

	// if (frame % 30 == 0) {
	// 	enemy = new Enemy();
	// }
}

function Enemy() {
	this.xPosition = Math.round(Math.random() * 1000);
	this.yPosition = Math.round(Math.random() * 500);
	this.radius = Math.round(Math.random() * 30) + 20;
}

function drawScreen() {
	var canvas=document.getElementById("mCanvas");
	var context=canvas.getContext("2d");

	context.fillStyle="#000000";
	context.fillRect(0,0,1000,500);

	brightness = Math.round(flashTime / 10 * 255);
	context.fillStyle="rgb("+brightness+","+brightness+","+brightness+")";
	context.fillRect(0,0,1000,500);

	context.strokeStyle="#FF0000";
	context.lineWidth=enemy.radius / 5;
	context.fillStyle="#FFFFFF";
	context.beginPath();
	context.arc(enemy.xPosition, enemy.yPosition, enemy.radius, 0, 2*Math.PI);
	context.fill();
	context.beginPath();
	context.arc(enemy.xPosition, enemy.yPosition, enemy.radius, 0, 2*Math.PI);
	context.stroke();
	context.beginPath();
	context.arc(enemy.xPosition, enemy.yPosition, enemy.radius * 2 / 3, 0, 2*Math.PI);
	context.stroke();
	context.beginPath();
	context.arc(enemy.xPosition, enemy.yPosition, enemy.radius * 1 / 3, 0, 2*Math.PI);
	context.stroke();
	context.lineWidth=1;

	context.strokeStyle="#FFFFFF";
	context.beginPath();
	context.arc(mouseX, mouseY, 20, 0, 2*Math.PI);
	context.stroke();

	context.fillStyle="#00FF00";
	context.font = "bold 24px sans-serif";
	context.fillText("Score : " + points, 10, 24);

	context.moveTo(mouseX - 7, mouseY);
	context.lineTo(mouseX + 7, mouseY);
	context.stroke();

	context.moveTo(mouseX, mouseY - 7);
	context.lineTo(mouseX, mouseY + 7);
	context.stroke();

	if (flashTime > 0) {
		flashTime--;
	}
}


</script>

<!-- <audio id="gunshot" src="./gunshot.mp3" preload="auto"></audio> -->
<!-- <audio id="music" src="http://www.dwerden.com/SoundFiles/Military/MarineBand/Barnum_and_Baileys_Favorite.mp3" preload="auto" loop="true" oncanplay="play();"></audio> -->
</head>
<body>
	<header>
	<h1>That Bulls Eyes! </h1>
	</header>
	<nav> 
		 <a href="index.html">Home</a>
		<a href="howto.html">How to? </a>
	</nav>
	<div id="rightC">
		<canvas width="1000px" height="500px" id="mCanvas" onload="handleMouseMove(event);" onmousemove="handleMouseMove(event);" onmousedown="handleMouseClick();"></canvas><br>
		<textarea id="mTextArea" ></textarea>
	</div>
</body>